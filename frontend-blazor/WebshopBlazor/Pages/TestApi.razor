@page "/test-api"

<h3>Products</h3>

<table class="table">
    <thead>
    <tr>
        <th>Product Name</th>
        <th>Price</th>
        <th>Stock Quantity</th>
    </tr>
    </thead>
    <tbody>
    @foreach (var product in products)
    {
        <tr>
            <td>@product.Name</td>
            <td>$@product.Price</td>
            <td>@product.Stock_Quantity</td>
            <td>
                <button class="btn btn-primary" @onclick="() => AddToCart(product.Id, 1)">Add to Cart</button>
            </td>
        </tr>
    }
    </tbody>
</table>

@code {
    private List<Product> products = new();

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var http = new HttpClient { BaseAddress = new Uri("http://localhost:8080") };
            products = await http.GetFromJsonAsync<List<Product>>("/products");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error fetching products: {ex.Message}");
        }
    }
    private async Task AddToCart(long productId, int quantity)
    {
        try
        {
            var http = new HttpClient { BaseAddress = new Uri("http://localhost:8080") };
            var queryParams = $"?productId={productId}&quantity={quantity}";
            await http.PostAsync($"/api/cart{queryParams}", null);
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error adding to cart: {ex.Message}");
        }
    }

    public class Product
    {
        public long Id { get; set; }
        public string Name { get; set; }
        public double Price { get; set; }
        public int Stock_Quantity { get; set; }
        public string Image { get; set; }
    }
}